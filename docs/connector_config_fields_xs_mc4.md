[Add Connector Configuration](connector_config_create_co4)
 > Citrix MCS for XenServer
#Connector Configuration ; Optional Script  (MCS for XenServer)<a name="Azure_Platform_Connector_Fields"></a>
In this article:
<table>            <col></col>            <tbody>                <tr>                    <td>                        <p><a href="#Before"> Before you start</a>                        </p>                        <p><a href="#Create"> Create a Connector Configuration</a>                        </p>                        <p><a href="#Configure_Script_Path"> Script Configuration (Optional, Advanced feature)</a>                        </p>                    </td>                </tr>            </tbody>        </table>
An MCS for XenServer Connector Configuration contains the credentials and storage location Unidesk needs to publish Layered Images to MCS in your XenServer environment. 
You can publish Layered Images to MCS running in a XenServer environment using an MCSfor XenServer Connector Configuration. In the Connector Configuration wizard, be sure to configure a Virtual Machine Template, so that the Layered Image you publish will be in a ready-to-use VM, the image shut down and a snapshot taken. You can use the VM in your Horizon environment without further modifications.
Each Connector Configuration is set to publish Layered Images to a specific storage location in your environment, so you may need more than one MCS Connector Configuration if publishing to multiple locations. Further, you may want to publish each Layered Image to a location convenient to the system you will be provisioning with the published image. For more about Connectors, and Connector Configurations, see [ Connector essentials](connectors_about_co4)[. ](connectors_about_co4)
Notes:
<ul>            <li>This Connector Configuration is for publishing Layered Images. You cannot package Layers in the MCSenvironment. For packaging Layers, use a XenServer Connector Configuration.</li>            <li>Personal vDisks are <i>not</i> supported for MCS. The published desktop images will be non-persistent. Currently, vDisks can only be used when publishing to Citrix PVS.</li>        </ul>
In this article:
<table>            <col></col>            <tbody>                <tr>                    <td>                        <p><a href="#Before"> Before you start</a>                        </p>                        <p><a href="#Create"> Create a Connector Configuration</a>                        </p>                        <p><a href="#Configure_Script_Path"> Script Configuration (Optional, Advanced feature)</a>                        </p>                    </td>                </tr>            </tbody>        </table>
A Citrix XenServer Connector Configuration contains the credentials and storage location Unidesk needs to connect to Citrix XenServer. 
##Before you start<a name="Before"></a>
You can use your XenServer environment for creating Layers, and for publishing Layered Images. Each Connector Configuration accesses a specific storage location in your XenServer environment. You may need more than one XenServer Connector Configuration to access the correct location for each purpose. Further, you may want to publish each Layered Image to a location convenient to the system you will be provisioning with the published image. For more about Connectors, and Connector Configurations, see [About Connectors](connectors_about_co4)[. ](connectors_about_co4)
Since XenServer  uses a pod-like architecture where you, the administrator, interact with individual servers or clusters of servers, rather than with a central management server, you manage these pods via command line access or GUI management software like XenCenter, which you install directly on your desktop and connect individually to each standalone host or to clusters of hosts. 
###If this is your first time using Unidesk <a name="How"></a>
If this is your first time using Unidesk and you want to create Unidesk Layers using a XenServer VM, you will need a XenServer Connector within Unidesk. When publishing Layered Images to XenServer, you will need a Connector Configuration for each of your publishing locations as well. 
The Create Layer and Publish Layered Image wizards each ask you to select a Connector Configuration. If you don't yet have the right Connector Configuration for the task, you can create one by clicking New on the Connector wizard tab (details below).
###Required information for XenServer Connector Configuration settings<a name="Creds"></a>
The XenServer Connector Configuration wizard let's you browse for the XenCenter Server, Data Store, and Host to use for a new configuration. 
Important: The fields are case sensitive, so any values that you enter manually must match the case of the object in XenServer, or the validation will fail. 
<ul>            <li><b>Configuration Name</b> - A useful name to help identify and keep track of this connector configuration. </li>            <li><b>XenServer Address</b> - The name of the XenServer host with which the Unidesk ELM will integrate. </li>            <li><b>User Name/Password</b> - The credentials for the account that the Unidesk ELM will use to connect to XenServer. </li>            <li><b>Use Secured Protocol</b> - Lets you use SSL encryption for the API connection traffic between the Unidesk Connector and Citrix XenServer. This field is checked by default.</li>            <li><b>Allow Certificate Errors</b> - Enables certificate errors to be ignored. By default, this setting is disabled. </li>            <li><b>Template</b> - VM Template that can be used for cloning. The list of choices will only contain custom VM templates, rather than actual VMs or any of the built-in templates. The selected template must <i>not</i> have any disks attached, and must have at least one network card attached. If it does not, you will see an error when trying to validate or save the configuration.</li>            <li><b>Storage Repository</b> - The storage repository for the disk that will get uploaded. The list will be filtered to only show repositories that can contain VHDs (ISO repositories are filtered out). </li>            <li><b>Use HTTPS for File Transfers</b> - Encrypts the image file transfers. HTTPS is checked by default for more secure uploads and downloads, but can be unchecked for increased performance. </li>        </ul>
###Virtual Machine organization
XenServer allows for VMs to be organized either by folder or by tag. These organizational tools are optional when creating and managing VMs through XenCenter or other tools. Although XenServer Connector Configurations do not allow the administrator to specify folders or tags, the VMs created by the XenServer Connector, both Packaging Machines and published Layered Images, can utilize both organizational tools.
####Tags
If the template specified in the XenServer connector configuration has any tags, then those tags will be carried over to any VM cloned from that template. Therefore all packaging VMs or published layered images will be tagged with the same tags that the template has. Additionally, the XenServer connector will add three tags.
<ul>            <li><b>Unidesk</b> - All VMs created by the XenServer connector can be found by this tag regardless of their purpose or image.</li>            <li><b>Purpose Tag</b> - All packaging machines will be tagged with "Unidesk Packaging Machine" while all published layered image VMs will be tagged with "Unidesk Published Images".</li>            <li><b>Image/Layer Name</b> - All packaging machines will be tagged with the layer name for the layer which they are generated, while all published layered images will be tagged with the template image name.</li>        </ul>
If you are using XenCenter, you can view your VMs by tag by selecting the "Organization Views" and then select "By Tag".
####Folder
By default VMs created by the XenServer Connector will not be placed in a folder. However, if the template specified in the XenServer Connector Configuration resides in a folder, then any VM that the Connector creates from that template will also reside in the same folder. All packaging VMs and published Layered Images will be placed in that same folder. There will not be separate subfolders for packaging VMs or published Layered Iimages.
###Machine network connectivity
The virtual network settings of the source template specified in the XenServer Connector Configuration will be carried over when creating any VMs through the XenServer Connector. There is no option in the Connector Configuration UI to override the network settings.
###XenServer Clusters
The XenServer Connector does not yet work correctly with XenServer clusters. If the host specified in the configuration is part of a cluster, then it must be the master host in the cluster for the connector to work. However, this means that any time the master XenServer host goes down and a new master is elected, the XenServer configuration must be updated.
##Create a Connector Configuration<a name="Create"></a>
To enter values:
<ul>            <li>The first three Connector fields must be entered manually. Once the credentials in those fields are validated, you can select values for the remaining fields from drop-down menus.</li>            <li>To enter values manually, click to put the cursor in the field and type the value, making sure that the case matches the value in Xen.</li>            <li>To select a value from a drop-down list, click once to put the cursor in the field, and a second time to display the list of possible values.</li>        </ul>
To add a new Connector Configuration:
<ol>            <li>On the wizard for creating a Layer or for adding a Layer Version, click the <b>Connector</b> tab. </li>            <li>Below the list of Connector Configurations, click the <b>New</b> button. This opens a small dialog box.</li>            <li>Select the Connector Type for the platform and location where you are creating the Layer or publishing the image. Then click <b>New</b> to open the Connector Configuration page.  </li>            <li>Enter the configuration <i>Name</i>, and the <i>XenServer Address</i>, <i>User Name</i>, and <i>Password</i>). For guidance, see the above field definitions.</li>            <li>Click the <b>CHECKCREDENTIALS</b> button below the XenServer Configuration fields. The Virtual Machine Clone Settings field is then enabled. </li>            <li>Select the Virtual Machine Template. </li>            <li>Select the Storage Repository and click the <b>TEST</b>button to verify that Unidesk can access the location specified using the credentials supplied.</li>            <li>Click <b>Save</b>. The new Connector Configuration should now be listed on the Connector page.</li>        </ol>
##Script Configuration (Optional, Advanced feature)<a name="Configure_Script_Path"></a>
When creating a new Connector Configuration, you can configure an optional Powershell script to run on any Windows machine running a Unidesk Agent. These scripts must be stored on the same machine that the Unidesk Agent is installed on, and will only be executed after a successful deployment of a Layered Image. 
Some preset variables are available to enable scripts to be reusable with different template images and different connector configurations. These variables will also contain information needed to identify the virtual machine created as part of the published Layered Image in XenServer.
Execution of these scripts will not affect the outcome of the publish job, and progress of commands executed in the script will not be visible. The XenServer connector logs will contain the output of the executed script.
###Configure a Script (optional)
If you want a script to run each time a Layered Image is published, complete these steps using the values described in the sections that follow.
<ol>            <li>                <p>Complete and save the Connector Configuration as described above.</p>                <p><b>Note:</b> Before selecting Script Configuration page, you must save (or discard) any edits to the Connector Configuration settings, </p>            </li>            <li>                <p>If the Navigation menu on the left is not open, select it and click <b>Script Configuration</b> to open the Script Path page.</p>            </li>            <li>                <p>Complete the required fields using the values detailed herein, and click <b>Save</b>.</p>            </li>        </ol>
###Script Configuration fields<a name="Creds"></a>
<ul>            <li><b>Enable script</b> - Select this check box to enable the remaining fields. This allows you to enter a script that will be executed each time a Layered Image is published.</li>            <li><b>Script Agent</b> - The agent machine where the scripts will be located and executed from.</li>            <li><b>Username (optional)</b> - The username to <i>impersonate</i> when running the script. This can be used to ensure the script runs in the context of a user that has the needed rights/permissions to perform the operations in the script.</li>            <li><b>Password (optional)</b> - The password for the specified username.</li>            <li><b>Path</b> - A full path and filename on the agent machine where the script file resides.</li>        </ul>
###Other Script Configuration values
####Powershell variables
When the script is executed the following variables will be set and can be used in the powershell script:
<table>            <col></col>            <col></col>            <col></col>            <col></col>            <thead>                <tr>                    <th>Value</th>                    <th>Applies to connector types:</th>                    <th>Value determined by which code:</th>                    <th>Description</th>                </tr>            </thead>            <tbody>                <tr>                    <td>connectorCfgName</td>                    <td>All </td>                    <td>Common code</td>                    <td>This is the name of the connector configuration that the script configuration is associated with.</td>                </tr>                <tr>                    <td>imageName</td>                    <td>All</td>                    <td>Common code</td>                    <td>This is the name of the layered image template that was used to build/publish the layered image.</td>                </tr>                <tr>                    <td>osType</td>                    <td>All</td>                    <td>Common code</td>                    <td>                        <p>This is the OS type of the layered image that was published. It can be one of the following values:</p>                        <ul>                            <li>Windows7</li>                            <li>Windows764</li>                            <li>Windows200864</li>                            <li>Windows201264</li>                            <li>Windows10</li>                            <li>Windows1064</li>                        </ul>                    </td>                </tr>                <tr>                    <td>virtualInfrastructureServer</td>                    <td>All</td>                    <td>XenServer connector code</td>                    <td>The XenServer host specified in the connector configuration.</td>                </tr>                <tr>                    <td>vmName</td>                    <td>All</td>                    <td>XenServer connector code</td>                    <td>The name of the virtual machine that was created.</td>                </tr>                <tr>                    <td>vmId</td>                    <td>All</td>                    <td>XenServer connector code</td>                    <td>The virtual machine UUID (same as vmUuid)</td>                </tr>                <tr>                    <td>vmUuid</td>                    <td>All</td>                    <td>XenServer connector code</td>                    <td>The virtual machine UUID  (same as vmId)</td>                </tr>            </tbody>        </table>
####Definition Scope 
Whether the scripts variable is set for all platform connector types or whether it is specific to a particular connector type.
####Value Source
Whether the variable value is determined by common code or by platform connector specific code.

