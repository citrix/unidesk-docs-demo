[Add Connector Configuration](connector_config_create_co4)
 > VMware vSphere
#Connector Configuration ; Optional Script  (vSphere)<a name="vSphere_Connector_Fields"></a>
In this article:
<table>            <col></col>            <tbody>                <tr>                    <td>                        <p><a href="#Before"> Before you start</a>                        </p>                        <p><a href="#Create"> Create a Connector Configuration</a>                        </p>                        <p><a href="#Configure_Script_Path"> Script Configuration (Optional, Advanced feature)</a>                        </p>                    </td>                </tr>            </tbody>        </table>
A vSphere Connector Configuration contains the credentials and storage location Unidesk needs to connect to vSphere. 
##Before you start<a name="Before"></a>
You can use your vSphere environment for creating Layers, and for publishing Layered Images. Each Connector Configuration accesses a specific storage location. You may need more than one vSphere Connector Configuration to access the correct location for each purpose. Further, you may want to publish each Layered Image to a location convenient to the system you will be provisioning with the published image. For more about Connectors, and Connector Configurations, see [About Connectors](connectors_about_co4)[. ](connectors_about_co4)
###If this is your first time using Unidesk <a name="How"></a>
If this is your first time using Unidesk and you want to create Unidesk Layers using a vSphere VM, you will need a vSphere Connector. If you are also publishing Layered Images to vSphere, you can create a Connector Configuration for each of your publishing locations as well. 
The Create Layer and Publish Layered Image wizards each ask you to select a Connector Configuration. If you don't yet have the right Connector Configuration for the task, you can create one by clicking New on the Connector wizard tab (details below).
###Required information for vSphere Connector Configuration settings<a name="Creds"></a>
The vSphere Connector Configuration wizard let's you browse for the vCenter Server, Data Store, and Host to use for a new configuration. 
Important: The fields are case sensitive, so any values that you enter manually must match the case of the object in vSphere, or the validation will fail. 
<ul>            <li><b>Name</b> - A useful name to help identify and keep track of this connector configuration. </li>            <li><b>vCenter Server</b> - The name of the vSphere server with which the Unidesk ELM will integrate. </li>            <li><b>vCenter User Name</b> - The user name of the account that the Unidesk ELM will use to connect to vSphere. </li>            <li><b>vCenter Password</b> - The password of the account that the Unidesk ELM will use to connect to vSphere. </li>            <li><b>DataCenter Name</b> - The name of the vSphere DataCenter in which the Unidesk ELM will create and retrieve virtual machines.</li>            <li>                <p><b>Layer Disk Cache Size in GB (optional)</b> - The size of the Disk Cache that Unidesk use when creating Layers.  If you leave the size blank or set it to 0, Unidesk does not use a Disk Cache.  If you specify a size, Unidesk users a Disk Cache of up to this size to keep copies of boot disks and packaging disks and reuses these disks to create new packaging machines.  The reuse of these boot disks and packaging disks reduces the time it takes to package an Application Layer.</p>            </li>            <li><b>DataStore Name</b> - The name of the vSphere DataStore in which the Unidesk ELM will create and retrieve virtual machines.</li>            <li><b>ESXHost Name</b> - The name of the vSphere ESX Host on which the Unidesk ELM will create and retrieve virtual machines. </li>            <li><b>Network Name</b> - The name of the vSphere Network in which the Unidesk ELM will create and retrieve virtual machines. </li>            <li><b>Virtual Machine Folder Name</b> - The name of the vSphere Folder in which the Unidesk ELM will create and retrieve virtual machines. </li>        </ul>
##Create a Connector Configuration<a name="Create"></a>
To enter values:
<ul>            <li>The first three vCenter fields must be entered manually. Once the credentials in those fields are validated, you can select values for the remaining fields from drop-down menus.</li>            <li>To enter values manually, click to put the cursor in the field and type the value, making sure that the case matches the value in vCenter.</li>            <li>To select a value from a drop-down list, click once to put the cursor in the field, and a second time to display the list of possible values.</li>        </ul>
To add a new Connector Configuration:
<ol>            <li>On the wizard for creating a Layer or for adding a Layer Version, click the <b>Connector</b> tab. </li>            <li>Below the list of Connector Configurations, click the <b>New</b> button. This opens a small dialog box.</li>            <li>Select the Connector Type for the platform and location where you are creating the Layer or publishing the image. Then click <b>New</b> to open the Connector Configuration page.  </li>            <li>Enter the configuration <i>Name</i>, and the <i>vCenter Server</i>, <i>vCenter User Name</i>, and <i>vCenter Password</i>). For guidance, see the above field definitions.</li>            <li>Click the <b>CHECKCREDENTIALS</b> button below the vCenter fields. The DataCenter field is then enabled with a list of DataCenters available. </li>            <li>Select the DataCenter, and the remaining dropdowns will be enabled. </li>            <li>Complete the remaining fields and click the <b>TEST</b>button to verify that Unidesk can access the location specified using the credentials supplied.</li>            <li>Click <b>Save</b>. The new Connector Configuration should now be listed on the Connector page.</li>        </ol>
##Script Configuration (Optional, Advanced feature)<a name="Configure_Script_Path"></a>
When creating a new Connector Configuration, you can configure an optional Powershell script on any Windows machine running a Unidesk Agentâ€”the same agent used on the PVS server. These scripts must be stored on the same machine that the Unidesk Agent is installed on, and will only be executed after a successful deployment of a Layered Image. Some preset variables are available to enable scripts to be reusable with different template images and different connector configurations. These variables will also contain information needed to identify the virtual machine created as part of the published layered image in vSphere.
Execution of these scripts will not affect the outcome of the publish job, and progress of commands executed in the script will not be visible. The vSphere connector logs will contain the output of the executed script.
###Configure a Script (Remember, this is optional)
If you want a script to run each time a Layered Image is published, complete these steps using the values described in the sections that follow.
<ol>            <li>                <p>Complete and save the Connector Configuration as described above.</p>                <p><b>Note:</b> Before selecting Script Configuration page, you must save (or discard) any edits to the Connector Configuration settings, </p>            </li>            <li>                <p>If the Navigation menu on the left is not open, select it and click <b>Script Configuration</b> to open the Script Path page.</p>            </li>            <li>                <p>Complete the required fields using the values detailed herein, and click <b>Save</b>.</p>            </li>        </ol>
###Script Configuration fields<a name="Creds"></a>
<ul>            <li><b>Enable script</b> - Select this check box to enable the remaining fields. This allows you to enter a script that will be executed each time a Layered Image is published.</li>            <li><b>Script Agent</b> - The agent machine where the scripts will be located and executed from.</li>            <li><b>Username (optional)</b> - The username to <i>impersonate</i> when running the script. This can be used to ensure the script runs in the context of a user that has the needed rights/permissions to perform the operations in the script.</li>            <li><b>Password (optional)</b> - The password for the specified username.</li>            <li><b>Path</b> - A full path and filename on the agent machine where the script file resides.</li>        </ul>
###Other Script Configuration values
####Powershell variables
When the script is executed the following variables will be set and can be used in the powershell script:
<table>            <col></col>            <col></col>            <col></col>            <col></col>            <thead>                <tr>                    <th>Value</th>                    <th>Applies to connector types:</th>                    <th>Value determined by which code:</th>                    <th>Description</th>                </tr>            </thead>            <tbody>                <tr>                    <td>connectorCfgName</td>                    <td>All </td>                    <td>Common code</td>                    <td>This is the name of the connector configuration that the script configuration is associated with.</td>                </tr>                <tr>                    <td>imageName</td>                    <td>All</td>                    <td>Common code</td>                    <td>This is the name of the layered image template that was used to build/publish the layered image.</td>                </tr>                <tr>                    <td>osType</td>                    <td>All</td>                    <td>Common code</td>                    <td>                        <p>This is the OS type of the layered image that was published. It can be one of the following values:</p>                        <ul>                            <li>Windows7</li>                            <li>Windows764</li>                            <li>Windows8</li>                            <li>Windows864</li>                            <li>Windows200864</li>                            <li>Windows201264</li>                            <li>Windows10</li>                            <li>Windows1064</li>                        </ul>                    </td>                </tr>                <tr>                    <td>virtualInfrastructureServer</td>                    <td>All</td>                    <td>vSphere connector code</td>                    <td>The vCenter server specified in the connector configuration.</td>                </tr>                <tr>                    <td>vmName</td>                    <td>All</td>                    <td>vSphere connector code</td>                    <td>The name of the virtual machine that was created.</td>                </tr>                <tr>                    <td>vmId</td>                    <td>All</td>                    <td>vSphere connector code</td>                    <td>The virtual machine ID taken from the mobref of the vm (i.e. "vm-12345")</td>                </tr>                <tr>                    <td>vmUuid</td>                    <td>All</td>                    <td>vSphere connector code</td>                    <td>The virtual machine UUID as set by the underlying highbrd.</td>                </tr>            </tbody>        </table>
####User Impersonation
The Unidesk Agent, which runs as a service on a Windows machine, runs under either the local system account or the network account. Either of these accounts may have some special privileges, but they often are restricted when it comes to executing specific commands or seeing files in the file system. Therefore, Unidesk gives you the option of adding a domain user and password that can be used to "impersonate" a user. This means that the script can be executed as if that user had logged onto the system so that any commands or data will be accessible subject to those user rights and permissions. If no user name or password is entered, the script executes using the account under which the service is configured to run.
####Script Execution Policy
Script execution policy requirements are generally up to you. If you intend to run unsigned scripts, you must configure the execution policy to one of the more lenient policies. However, if you sign your own scripts accordingly, you can choose to use a more restrictive execution policy.
