[Add Connector Configuration](connector_config_create_co4)
 > Citrix MCS for Nutanix AHV
#Connector Configuration ; Optional Script  (MCS for Nutanix AHV)<a name="Azure_Platform_Connector_Fields"></a>
In this article:
<table>            <col></col>            <tbody>                <tr>                    <td>                        <p><a href="#Before"> Before you start</a>                        </p>                        <p><a href="#Create"> Create a Connector Configuration</a>                        </p>                        <p><a href="#Configure_Script_Path"> Script Configuration (Optional, Advanced feature)</a>                        </p>                    </td>                </tr>            </tbody>        </table>
An MCS for Nutanix AHV (Acropolis) Connector Configuration contains the credentials and storage location Unidesk needs to publish Layered Images to MCS in your Nutanix AHV environment. This connector does not support Layer creation.
##Before you start<a name="Before"></a>
You can use MCS for Nutanix AHV  to publish Layered Images. Each Connector Configuration accesses a specific storage location in your Nutanix AHV environment to which you can publish Layered Images. 
You may need more than one Nutanix AHV Connector Configuration to access the correct location for each purpose. Further, you may want to publish each Layered Image to a location convenient to the systems you will be provisioning with the published image. For more about Connectors, and Connector Configurations, see [About Connectors](connectors_about_co4)[. ](connectors_about_co4)
###If this is your first time using Unidesk <a name="How"></a>
When publishing Layered Images to Nutanix AHV, you will need at least one Connector Configuration for each storage location you plan to publish to. You can add  Connector Configurations when creating an Image Template from which you will publish Layered Images. If you don't yet have the right Connector Configuration for the task, you can create one by clicking New on the Connector wizard tab (see details below).
###Required information for Nutanix AHV Connector Configuration settings<a name="Creds"></a>
The Nutanix AHV Connector Configuration wizard let's you browse for the Nutanix AHV Server, Data Store, and Host to use for a new configuration. 
Important: The fields are case sensitive, so any values that you enter manually must match the case of the object in Nutanix AHV, or the validation will fail. 
<ul>            <li><b>Connector Name</b> - A useful name to help identify and keep track of this connector configuration. </li>            <li><b>Prism Address</b> - The host name (resolvable via DNS) or IP address of the Prism Web Console. This is the same address you use to access the Nutanix Prism Web Console.. </li>            <li>                <p><b>User Name/Password</b> - Credentials that will be used when interacting with the Nutanix system. The specified user must have sufficient privileges for the following operations: </p>                <ul>                    <li>VM operations:<ul><li>clone</li><li>delete</li><li>power on/off</li><li>attach virtual disks</li></ul></li>                    <li>Image operations:<ul><li>create</li><li>update (aka upload)</li><li>delete</li></ul></li>                    <li>Virtual disks:<ul><li>create</li><li>attach to VMs</li></ul></li>                </ul>            </li>            <li><b>Allow Certificate Errors</b> - Lets you use SSL encryption for the API connection traffic between the Unidesk Connector and Nutanix AHV. This field is unchecked by default.</li>            <li><b>Template</b> - This is a drop down list of existing virtual machines that can be used for cloning. There is no concept of a "template" in Nutanix, so these VMs are actual VMs. The selected template must <i>not</i> have any disks attached, and must have at least one network card attached. If it does not, you will see an error when trying to validate or save the configuration.</li>            <li><b>Storage Container</b> - Lets you select the storage container for the images (vhds) that will get uploaded and the resulting virtual disks that will get created from those images. When creating App Layers and OS Layer versions, we are required to mount the storage container as an NFS mount point. This means that the selected storage container MUST have the ELM included in a white list of clients that are allowed to mount the storage container via NFS. The white list configuration must be done through the Nutanix product (either their web console or through their CLI tools). If the ELM is not properly white listed for the selected storage container, then the validation phase will fail, and the error will be indicated with the storage container selection.</li>        </ul>
###How Virtual Machines are Organized
Nutanix does not provide a mechanism for organizing virtual machines. Because of this, it may be difficult to find the virtual machines created by your Unidesk ELM when the total number of virtual machines is large. To help you find these VMs, the following naming conventions are used:
<ul>            <li><b>Packaging Machines</b> (virtual machines created during the process of creating an App Layer or OSVersion)<ul><li>The virtual machine name will start with the layer name that is being created/modified</li><li>The virtual machine names will end with the following text: (Unidesk Packaging Machine)</li></ul></li>            <li><b>Layered Image Virtual Machines</b> (virtual machines created as a result of publishing a Layered Image)<ul><li>The virtual machine name will start with the image name that was published</li><li>The virtual machine name will end with the following text: (Unidesk Published Image)</li></ul></li>        </ul>
When viewing virtual machines through the Nutanix web console, you can search for virtual machines by filtering on:
<ul>            <li>"Unidesk" to find all virtual machines created by Unidesk</li>            <li>"Unidesk Packaging Machine" to find all virtual machines created for Layer management jobs.</li>            <li>"Unidesk Layered Image" to find all virtual machines created to publish a Layered Image.</li>            <li>Image name or Layer name to find virtual machines related to a specific Layered Image publishing job or App or OS creation.</li>        </ul>
###Virtual Machine Network Connectivity
The virtual network settings of the source template specified in the Nutanix AHV Connector Configuration will be carried over when creating any VMs through the Nutanix Acropolis Hypervisor (AHV) Connector. There is no option in the Connector Configuration UI to override the network settings.
##Create a Connector Configuration<a name="Create"></a>
To enter values:
<ul>            <li>The first three Connector fields must be entered manually. Once the credentials in those fields are validated, you can select values for the remaining fields from drop-down menus.</li>            <li>To enter values manually, click to put the cursor in the field and type the value, making sure that the case matches the value in Nutanix AHV.</li>            <li>To select a value from a drop-down list, click once to put the cursor in the field, and a second time to display the list of possible values.</li>        </ul>
To add a new Connector Configuration:
<ol>            <li>On the wizard for creating a Layer or for adding a Layer Version, click the <b>Connector</b> tab. </li>            <li>Below the list of Connector Configurations, click the <b>New</b> button. This opens a small dialog box.</li>            <li>Select the Connector Type for the platform and location where you are creating the Layer or publishing the image. Then click <b>New</b> to open the Connector Configuration page.  </li>            <li>Enter the configuration <i>Name</i>, and the <i>Nutanix AHV Address</i>, <i>User Name</i>, and <i>Password</i>). For guidance, see the above field definitions.</li>            <li>Click the <b>CHECKCREDENTIALS</b> button below the Nutanix AHV Configuration fields. The Virtual Machine Clone Settings field is then enabled. </li>            <li>Select the Virtual Machine Template. </li>            <li>Select the Storage Repository and click the <b>TEST</b>button to verify that Unidesk can access the location specified using the credentials supplied.</li>            <li>Click <b>Save</b>. The new Connector Configuration should now be listed on the Connector page.</li>        </ol>
##Script Configuration (Optional, Advanced feature)<a name="Configure_Script_Path"></a>
When creating a new Connector Configuration, you can configure an optional Powershell script to run on any Windows machine running a Unidesk Agent. These scripts must be stored on the same machine that the Unidesk Agent is installed on, and will only be executed after a successful deployment of a Layered Image. 
Some preset variables are available to enable scripts to be reusable with different template images and different connector configurations. These variables will also contain information needed to identify the virtual machine created as part of the published Layered Image in Nutanix AHV.
Execution of these scripts will not affect the outcome of the publish job, and progress of commands executed in the script will not be visible. The Nutanix AHV connector logs will contain the output of the executed script.
###Configure a Script (optional)
If you want a script to run each time a Layered Image is published, complete these steps using the values described in the sections that follow.
<ol>            <li>                <p>Complete and save the Connector Configuration as described above.</p>                <p><b>Note:</b> Before selecting Script Configuration page, you must save (or discard) any edits to the Connector Configuration settings, </p>            </li>            <li>                <p>If the Navigation menu on the left is not open, select it and click <b>Script Configuration</b> to open the Script Path page.</p>            </li>            <li>                <p>Complete the required fields using the values detailed herein, and click <b>Save</b>.</p>            </li>        </ol>
###Script Configuration fields<a name="Creds"></a>
<ul>            <li><b>Enable script</b> - Select this check box to enable the remaining fields. This allows you to enter a script that will be executed each time a Layered Image is published.</li>            <li><b>Script Agent</b> - The agent machine where the scripts will be located and executed from.</li>            <li><b>Username (optional)</b> - The username to <i>impersonate</i> when running the script. This can be used to ensure the script runs in the context of a user that has the needed rights/permissions to perform the operations in the script.</li>            <li><b>Password (optional)</b> - The password for the specified username.</li>            <li><b>Path</b> - A full path and filename on the agent machine where the script file resides.</li>        </ul>
###Other Script Configuration values
####Powershell variables
When the script is executed the following variables will be set and can be used in the powershell script:
<table>            <col></col>            <col></col>            <col></col>            <col></col>            <thead>                <tr>                    <th>Value</th>                    <th>Applies to connector types:</th>                    <th>Value determined by which code:</th>                    <th>Description</th>                </tr>            </thead>            <tbody>                <tr>                    <td>connectorCfgName</td>                    <td>Common</td>                    <td>Common</td>                    <td>This is the name of the connector configuration that the script configuration is associated with.</td>                </tr>                <tr>                    <td>imageName</td>                    <td>Common</td>                    <td>Common</td>                    <td>This is the name of the layered image template that was used to build/publish the layered image.</td>                </tr>                <tr>                    <td>osType</td>                    <td>Common</td>                    <td>Common</td>                    <td>                        <p>This is the OS type of the layered image that was published. It can be one of the following values:</p>                        <ul>                            <li>Windows7</li>                            <li>Windows7 64-bit</li>                            <li>Windows2008  64-bit</li>                            <li>Windows2012  64-bit</li>                            <li>Windows10</li>                            <li>Windows1064</li>                        </ul>                    </td>                </tr>                <tr>                    <td>virtualInfrastructureServer</td>                    <td>Common</td>                    <td>Nutanix AHV</td>                    <td>The Nutanix AHV (Prism Server) specified in the connector configuraiton.</td>                </tr>                <tr>                    <td>vmId</td>                    <td>Common</td>                    <td>Nutanix AHV</td>                    <td>The virtual machine UUID (same as vmUuid).</td>                </tr>                <tr>                    <td>vmName</td>                    <td>Common</td>                    <td>Nutanix AHV</td>                    <td>The name of the virtual machine that was created.</td>                </tr>                <tr>                    <td>vmNetwork</td>                    <td>Common</td>                    <td>Nutanix AHV</td>                    <td>The name of the virtual network that the main NIC of the virtual machine is connected to.</td>                </tr>                <tr>                    <td>vmNetworkId</td>                    <td>Common</td>                    <td>Nutanix AHV</td>                    <td>The UUID of the virtual network that the main NIC of the virtual machine is connected to.</td>                </tr>                <tr>                    <td>vmNetworkMAC</td>                    <td>Common</td>                    <td>Nutanix AHV</td>                    <td>The MAC address of the main NIC that is connected to the virtual network specified in vmNetwork and vmNetworkId.</td>                </tr>                <tr>                    <td>vmUuid</td>                    <td>Common</td>                    <td>Nutanix AHV</td>                    <td>The virtual machine UUID (same as vmId).</td>                </tr>            </tbody>        </table>
####Definition Scope
Defines whether the scripts variable is set for all Connector types or whether it is specific to a particular Connector type.
####Value Source
Defines whether the variable value is determined by common code or by Connector-specific code.
