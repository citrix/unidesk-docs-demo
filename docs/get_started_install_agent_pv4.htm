<!DOCTYPE html>
<html lang="en-us" xml:lang="en-us">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Install the Unidesk Agent (required for PVS and Connector Scripts)</title>
    </head>
    <body style="padding-left: 1.5em; padding-right: 1em; border-bottom-width: .5em; border-left-width: .5em; border-right-width: .5em; border-top-width: .5em; color: #000000; font-family: Arial, ' Helvetica', ' Sans Serif'; font-size: 9pt; margin-left: 0pt; text-align: left; background-color: #ffffff;">
        <div class="MCBreadcrumbsBox_0" style="border-bottom-color: #ffffff;border: 1px;border-bottom-width: 1px;border-top-width: 1px;border-left-width: 1px;border-right-width: 1px;font-size: 9pt;color: #636363;border-bottom-style: solid;padding-bottom: 10px;margin-bottom: 10px;"><span class="MCBreadcrumbsPrefix">You are here: </span><span class="MCBreadcrumbsSelf">Learn about Citrix App Layering [UnideskVersion Layering 4.0.8]</span><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbsSelf">Set up</span><span class="MCBreadcrumbsDivider"> &gt; </span><a class="MCBreadcrumbsLink" href="landing_set_up_co4.htm" style="text-decoration: underline;text-decoration-blink: false;color: #3e63b1;">Set up Unidesk</a><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbs">Install the Unidesk Agent (if using PVS or Connector Scripts)</span>
        </div>
        <h1 style="clear: both;width: 85%;page-break-before: always;color: #d31245;font-size: 20px;font-weight: 500;margin-bottom: 0.40em;margin-top: 0.4em;">Install the Unidesk Agent (required for PVS and Connector Scripts)</h1>
        <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">In this article:</p>
        <table style="border-collapse: collapse; border-left-style: none; border-left-width: 0px; border-right-style: none; border-right-width: 0px; border-top-style: none; border-top-width: 0px; border-bottom-style: none; border-bottom-width: 0px; border-spacing: 1px 1px; border-spacing-x: 1px; border-spacing-y: 1px; font-size: 10pt; width: 100%;" class="TableStyle-Noborders" cellspacing="1">
            <col class="TableStyle-Noborders-Column-Column1" />
            <tbody style="color: #4d4d4d;font-size: 9pt;margin: 0px;margin-left: 0px;margin-right: 0px;margin-top: 0px;margin-bottom: 0px;">
                <tr class="TableStyle-Noborders-Body-Body1" style="padding: 20px;padding-left: 40px;padding-right: 20px;padding-top: 20px;padding-bottom: 20px;">
                    <td class="TableStyle-Noborders-BodyA-Column1-Body1" style="padding-top: 0px;padding-bottom: 1px;text-align: left;vertical-align: top;padding-left: 6px;padding-right: 6px;margin-left: 0em;border-bottom-width: .5em;border-left-width: .5em;border-right-width: .5em;border-top-width: .5em;font-family: Arial, ' Helvetica', ' Sans Serif';color: #4d4d4d;font-size: 10pt;">
                        <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;"><a href="#About" class="MCXref_0 selected" style="text-decoration: underline;text-decoration-blink: false;color: #3e63b1;"> About installing the Unidesk Agent </a>
                        </p>
                        <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;"><a href="#Prereq" class="MCXref_0 selected" style="text-decoration: underline;text-decoration-blink: false;color: #3e63b1;"> Prerequisites</a>
                        </p>
                        <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;"><a href="#Create_Share" class="MCXref_0 selected" style="text-decoration: underline;text-decoration-blink: false;color: #3e63b1;"> Install the Unidesk Agent</a>
                        </p>
                        <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;"><a href="#Manual_Register" class="MCXref_0 selected" style="text-decoration: underline;text-decoration-blink: false;color: #3e63b1;"> Register with the Unidesk ELM manually</a>
                        </p>
                        <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;"><a href="#Next" class="MCXref_0 selected" style="text-decoration: underline;text-decoration-blink: false;color: #3e63b1;"> Next step</a>
                        </p>
                    </td>
                </tr>
            </tbody>
        </table>
        <h2 style="margin-bottom: .5em;margin-top: 1.750em;color: #303030;font-size: 15px;font-weight: 600;"><a name="About"></a>About installing the Unidesk Agent </h2>
        <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">The Unidesk Agent enables the Unidesk Enterprise Layer Manager (ELM) or a Unidesk Packaging Machine VM to run PowerShell commands locally. If you supply  the proper credentials, the agent can run PowerShell commands as a specific user. </p>
        <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">The Unidesk Agent is required in cases where one of your Connector Configurations  launches a PowerShell script. This includes Connector Configurations you use to:</p>
        <ul style="margin-left: 0px;padding-left: 15px;margin-top: 0.75em;">
            <li value="1" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">Publish Layered Images to a provisioning system. </li>
            <li value="2" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">Package Layers in your hypervisor environment.</li>
        </ul>
        <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">The Unidesk Agent installer prompts you to register the agent with a Unidesk ELM. If you do not register the agent during installation, you can manually register it later. However, keep in mind that the PowerShell scripts will not run until the agent is registered with the ELM. </p>
        <h2 style="margin-bottom: .5em;margin-top: 1.750em;color: #303030;font-size: 15px;font-weight: 600;"><a name="Prereq"></a>Prerequisites</h2>
        <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">Before you install the Unidesk Agent, you must have the following requirements on the system where you are installing the Unidesk Agent:</p>
        <ul style="margin-left: 0px;padding-left: 15px;margin-top: 0.75em;">
            <li value="1" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">An account with administrator privileges </p>
            </li>
            <li value="2" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">.NET 4.5</p>
            </li>
            <li value="3" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">PowerShell 3.0 or greater</p>
            </li>
            <li value="4" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">PowerShell Snap-in</p>
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">Before using the Unidesk Agent on a PVS server you must ensure the PowerShell Snap-in is installed. This is a manual step. </p>
                <ul style="margin-left: 0px;padding-left: 15px;">
                    <li value="1" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">
                        <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">For PVS 7.7 and later, you must install the Powershell Snap-in <span class="code" style="font-family: monospace;">Citrix.PVS.Snapin.dll</span>. </p>
                    </li>
                    <li value="2" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">
                        <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">For PVS 7.6 and PVS 7.1, you must install <span class="code" style="font-family: monospace;">McliPSSnapIn.dll</span>. Use the <span class="code" style="font-family: monospace;">installutil.exe</span> to install the Snap-in.</p>
                        <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">Example (7.6): </p>
                        <ol style="margin-left: 2.0em;padding-left: 0px;list-style-type: decimal;">
                            <li value="1" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">
                                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">From a command prompt, go to:</p>
                                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;"><code>c:\program files\citrix\provisioning services console</code>
                                </p>
                            </li>
                            <li value="2" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">
                                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">Run this command:</p><pre xml:space="preserve">"C:\Windows\Microsoft.NET\Framework64\v4.0.30319\InstallUtil.exe" McliPSSnapIn.dll</pre>
                            </li>
                        </ol>
                        <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">Example (7.7):</p>
                        <ol style="margin-left: 2.0em;padding-left: 0px;list-style-type: decimal;">
                            <li value="1" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">
                                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">From a command prompt, go to:</p>
                                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;"><code>c:\program files\citrix\provisioning services console</code>
                                </p>
                            </li>
                            <li value="2" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">
                                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">Run this command:</p><pre xml:space="preserve">"C:\Windows\Microsoft.NET\
Framework64\v4.0.30319\InstallUtil.exe" Citrix.PVS.snapin.dll</pre>
                            </li>
                        </ol>
                    </li>
                </ul>
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">On Windows 2008 R2, you must also enable PowerShell remote commands. For background information, see this Microsoft article:</p>
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">https://technet.microsoft.com/en-us/library/hh849694.aspx</p>
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">If your 2008 R2 OS does not have PowerShell remoting enabled, run the following PowerShell command on the PVS server:   </p><pre xml:space="preserve">Enable-PSRemoting</pre>
            </li>
        </ul>
        <h2 style="margin-bottom: .5em;margin-top: 1.750em;color: #303030;font-size: 15px;font-weight: 600;"><a name="Create_Share"></a>Install the Unidesk Agent</h2>
        <ol style="margin-left: 2.0em;padding-left: 0px;margin-top: 0.75em;list-style-type: decimal;">
            <li value="1" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">Log in as an administrator on the system where you are installing the agent. </p>
            </li>
            <li value="2" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">Download the Unidesk Agent from the Unidesk Download page. </p>
            </li>
            <li value="3" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">Copy the <span class="code" style="font-family: monospace;">Unidesk_agent_installer.exe</span> file from the Unidesk Agent folder to a convenient location on the PVS server.</p>
            </li>
            <li value="4" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">Run the <span class="code" style="font-family: monospace;">Unidesk_agent_installer.exe</span> as Administrator, and when prompted, enter the path to the directory where you want to install the Unidesk Agent. The default location is <span class="code" style="font-family: monospace;">C:\\Program Files (x86)\Unidesk\Agent</span>.</p>
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">The Unidesk Agent installer checks to see if all <a href="#Prereq" class="MCXref_0 selected" style="text-decoration: underline;text-decoration-blink: false;color: #3e63b1;"> Prerequisites</a> are present. If any prerequisites are missing, the installer reports this and exits without installing. </p>
            </li>
            <li value="5" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">The installer prompts you for an Agent Port number. You can accept the default port number (8016) or specify a different one if the default port is already in use.</p>
            </li>
            <li value="6" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">The installer prompts you for the credentials (<i>address</i>, <i>username</i>, and <i>password</i>) for your Unidesk ELM. Register the Unidesk Agent with the ELM by entering the IP address and login credentials for a Unidesk Management Console (UMC) user on the ELM with Administrator privileges, (for example, the credentials you use to log into the UMC). </p>
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;"><b>Note:</b> If the Unidesk ELM is not available yet or you choose not to register with it now, you can manually register at a later time using the procedure described in <a href="#Manual_Register" class="MCXref_0 selected" style="text-decoration: underline;text-decoration-blink: false;color: #3e63b1;"> Register with the Unidesk ELM manually</a>. </p>
            </li>
            <li value="7" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">Click <b>Finish</b> to exit the wizard.</p>
            </li>
        </ol>
        <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">The Unidesk Agent registration appears in the Audit log for the Management Service in the Unidesk Management Console.</p>
        <h2 style="margin-bottom: .5em;margin-top: 1.750em;color: #303030;font-size: 15px;font-weight: 600;"><a name="Manual_Register"></a>Register with the Unidesk ELM manually</h2>
        <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">If the Unidesk Agent was not registered with a Unidesk ELM&#160;during installation, you can register it later by using the following procedure.</p>
        <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">To manually register the Unidesk Agent with the ELM:</p>
        <ol style="margin-left: 2.0em;padding-left: 0px;margin-top: 0.75em;list-style-type: decimal;">
            <li value="1" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">As an <i>administrator</i>, log in to the server where you installed the Unidesk Agent.</p>
            </li>
            <li value="2" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">Open a command window (cmd.exe) as administrator and navigate to the directory where the Unidesk Agent is installed. (The default location is <span class="code" style="font-family: monospace;">C:\\Program Files (x86)\Unidesk\Agent</span>.)</p>
            </li>
            <li value="3" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">Run the following command, using the IP address of the ELM where indicated: </p>
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;"><span class="code" style="font-family: monospace;">Unidesk.Agent.Service.exe register /i /e:<i>IP_address_of_ELM</i> /u:Administrator</span> <![CDATA[ ]]></p>
            </li>
            <li value="4" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">When prompted, enter the password for a user who has Administrator privileges in the Unidesk Management Console (UMC) on the ELM. </p>
            </li>
            <li value="5" style="margin-left: 0px;margin-bottom: 0.75em;margin-top: 0.75em;font-size: 13px;color: #4d4d4d;">
                <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">When the registration process completes, a message appears informing you of the successful outcome. The Unidesk Agent registration appears in the Audit log for the Management Service in the UMC.</p>
            </li>
        </ol>
        <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;">If the process does not succeed, examine the <code>\Unidesk\Agent\Logs\unidesk.agent.log</code> file in the Unidesk Agent installation directory. You can also view Help for the Unidesk Agent command line options by running the following command: <span class="code" style="font-family: monospace;">Unidesk.Agent.Service.exe /?</span>.</p>
        <h2 style="margin-bottom: .5em;margin-top: 1.750em;color: #303030;font-size: 15px;font-weight: 600;"><a name="Next"></a>Next step</h2>
        <p style="text-align: left; margin-top: 1.12em; margin-bottom: 0.75em; font-size: 13px; color: #4d4d4d;"><a href="users_dir_service_co4.htm" class="MCXref_0" style="text-decoration: underline;text-decoration-blink: false;color: #3e63b1;"> Connect to a Directory Service</a>
        </p>
    </body>
</html>